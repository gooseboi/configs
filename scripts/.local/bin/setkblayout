#!/bin/sh

# Sets the keyboard layout
# Uses $1 if provided, and prompts
# the user if not

setup() {
	setxkbmap -option compose:rctrl
	setxkbmap -option caps:escape
	xset r rate 300 50
}

if [ -z "$1" ]; then
	kb_choice="$(awk '/! layout/{flag=1; next} /! variant/{flag=0} flag {print $2, "- " $1}' /usr/share/X11/xkb/rules/base.lst | rofi -dmenu -i -p "Choose a keyboard layout")"
	kb="$(echo "$kb_choice" | awk '{print $3}')"
	[ -z "$kb" ] && exit
	setxkbmap "$kb"
else
	[ "$1" = "-s" ] && kb=$2 || kb=$1
	setxkbmap "$kb"
fi
setup

[ ! "$1" = "-s" ] && notify-send "‚å® Keyboard layout" "$(printf "%s" "Current layout: $(setxkbmap -query | grep -oP 'layout:\s*\K\w+')")"
