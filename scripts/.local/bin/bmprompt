#!/bin/sh

bmfile="${XDG_CONFIG_HOME:-$HOME/.config}/bmlist"
delim=":"
prompt="rofi -dmenu"

getindex() {
	for i in "${!bmnames[@]}"; do
		if [[ "${bmnames[$i]}" = "$1" ]]; then
			printf "${i}";
			return 0
		fi
	done
	printf "bad"
}

addbookmark() {
	printf "%s:%s\n" "$1" "$2" >> $bmfile
}

openinbrowser() {
	$BROWSER $1
}

readfile=$(cat $bmfile)
bmnames=($(printf "$readfile" | awk -F $delim '{ print $1 }'))
bmlinks=($(printf "$readfile" | awk -F $delim '{ print $2 }'))

selectedname=$(for i in "${bmnames[@]}"; do echo $i; done | $prompt -p "Select a bookmark")
[ -z $selectedname ] && exit
index=$(getindex $selectedname)

if [ $index = "bad" ]; then
	option=$(printf "Yes\\nNo" | $prompt -i -p "Would you like to add this bookmark?")
	[ "$option" = "" ] || [ $option != "Yes" ] && exit
	newlink=$($prompt -p "Enter new link")
	addbookmark $selectedname $newlink
	openinbrowser $newlink
else
	selectedlink=${bmlinks[$index]}
	openinbrowser $selectedlink
fi
